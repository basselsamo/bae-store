<!-- views/products.ejs -->
<!DOCTYPE html>
<html>
<head>
    <title>Products</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script>
        function selectSize(productId, size) {
            document.querySelectorAll(`.size-option[data-product-id="${productId}"]`).forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelector(`.size-option[data-product-id="${productId}"][data-size="${size}"]`).classList.add('selected');
            document.querySelector(`#size-${productId}`).value = size;
        }
    </script>
</head>
<body>
    <%- include('partials/in-header', {title: 'Products' }) %>
        <div class="container">
            <aside class="sidebar">
                    <h2>Filter Products</h2>
                    <p>No filters available to apply yet.</p>
            </aside>
            <main>
                <h1>Products</h1>
                <div class="product-grid">
                    <% products.forEach(product=> {
                        const inStock = product.productSizesStock.some(sizeStock => sizeStock.stock > 0);
                        %>
                        <div class="product-card">
                            <img src="<%= product.productImages[0] %>" alt="<%= product.productBrand %>" class="brand-icon">
                            <img src="<%= product.productImages[1] %>" alt="<%= product.productTitle %>" class="product-image">
                            <h4><%= product.productTitle %></h4>
                            <p>Price: â‚¬<%= product.productPrice.toFixed(2) %></p>
                            <p class="<%= inStock ? 'available' : 'not-available' %>"><%= inStock ? 'In Stock' : 'Out Of Stock' %></p>
                            <!-- <input type="hidden" name="productId" value="<%= product._id %>">
                            <input type="hidden" name="size" id="size-<%= product._id %>" value=""> -->
                            <div class="available-sizes">
                                <% product.productSizesStock.forEach(sizeStock=> { %>
                                    <div class="size-option <%= sizeStock.stock > 0 ? '' : 'disabled' %>"
                                        data-product-id="<%= product._id %>" data-size="<%= sizeStock.size %>" <% if
                                        (sizeStock.stock> 0) { %>
                                        onclick="selectSize('<%= product._id %>', '<%= sizeStock.size %>')"
                                                <% } %>>
                                                    <%= sizeStock.size %>
                                    </div>
                                    <% }) %>
                            </div>
                            <div class="addtocart-button">
                                <button type="submit" <%=inStock ? '' : 'disabled' %>> <i class="fas fa-cart-plus"></i> Add to cart</button>
                            </div>
                        </div>
                        <% }) %>
                </div>
            </main>
        </div>
        <%- include('partials/footer') %>
</body>
</html>